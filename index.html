<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnHub Elite | Top Tier Rewards</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script async="async" data-cfasync="false" src="https://pl28695899.effectivegatecpm.com/d3b86a7a6ea6805fd2c9c7532410ddf5/invoke.js"></script>

    <style>
        :root { --primary: #00d2ff; --secondary: #3a7bd5; --success: #2ecc71; --glass: rgba(255, 255, 255, 0.07); }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: radial-gradient(circle at top right, #1e1e2f, #0f0c29); min-height: 100vh; margin: 0; color: #fff; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .app-container { width: 100%; max-width: 500px; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        .glass-card { background: var(--glass); backdrop-filter: blur(20px); padding: 25px 20px; border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 40px 80px rgba(0,0,0,0.4); text-align: center; margin-bottom: 20px; }
        
        /* Withdrawal Button - Large & Professional */
        .btn-withdraw-main {
            width: 100%; padding: 20px; background: linear-gradient(45deg, #f1c40f, #e67e22);
            color: #000; font-size: 18px; font-weight: 800; border: none; border-radius: 15px;
            cursor: pointer; margin-bottom: 20px; display: none; /* Hidden by default */
            box-shadow: 0 10px 20px rgba(230, 126, 34, 0.3); transition: 0.3s;
        }
        .btn-withdraw-main:hover { transform: scale(1.02); filter: brightness(1.1); }

        .about-section { text-align: left; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 20px 0; border-left: 4px solid var(--primary); }
        .about-section h2 { font-size: 18px; color: var(--primary); margin: 0 0 10px 0; }
        .feature-list { list-style: none; padding: 0; font-size: 12px; color: #aaa; }
        .feature-list li { margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .feature-list li::before { content: '‚òÖ'; color: #f1c40f; }

        .btn-google { background: white; color: #333; border: none; padding: 16px; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; font-size: 15px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .captcha-display { font-size: 40px; font-weight: 800; letter-spacing: 10px; margin: 20px 0; color: #fff; text-shadow: 0 0 15px var(--primary); }
        input { width: 100%; padding: 14px; border: none; border-radius: 12px; background: rgba(255, 255, 255, 0.08); color: #fff; font-size: 18px; text-align: center; margin-bottom: 15px; outline: none; }
        .btn-action { width: 100%; padding: 16px; border: none; border-radius: 12px; background: linear-gradient(45deg, var(--secondary), var(--primary)); color: #fff; font-size: 15px; font-weight: 600; cursor: pointer; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 8px; font-size: 13px; border-left: 3px solid transparent; }
        .top5 { border-left: 3px solid #f1c40f; background: rgba(241, 196, 15, 0.05); }
        #loginScreen, #mainDashboard, #proofSection, #withdrawPanel { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <audio id="successSnd" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <div id="loginScreen" class="glass-card" style="display: block;">
        <div style="font-size: 45px;">üöÄ</div>
        <h1 style="font-size: 28px; margin: 10px 0;">EarnHub Elite</h1>
        <div class="about-section">
            <h2>Platform Overview</h2>
            <p style="font-size: 13px; color: #ccc; line-height: 1.6;">EarnHub Elite is an exclusive digital reward system. Only the most dedicated contributors can reach the top and unlock financial rewards.</p>
            <ul class="feature-list">
                <li><b>Top 5 Exclusive:</b> Only the Top 5 leaders can withdraw.</li>
                <li><b>Daily Limits:</b> One withdrawal request per 24 hours.</li>
                <li><b>Secure Tasks:</b> Earn CP by completing security codes.</li>
                <li><b>Threshold:</b> Minimum 500 CP required to cash out.</li>
            </ul>
        </div>
        <button class="btn-google" onclick="signIn()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            Continue with Google
        </button>
    </div>

    <div id="mainDashboard">
        <button id="mainWithdrawBtn" class="btn-withdraw-main" onclick="showWithdraw()">üí∞ WITHDRAW REWARD NOW</button>

        <div class="glass-card">
            <div class="stat-grid">
                <div class="stat-box"><small>Worker</small><strong id="uNameDisp">...</strong></div>
                <div class="stat-box"><small>Balance</small><strong id="uPointsDisp">0 CP</strong></div>
            </div>

            <div id="workSection">
                <div class="captcha-display" id="captchaBox">----</div>
                <input type="number" id="userInput" placeholder="Security Code">
                <button id="submitBtn" class="btn-action" onclick="handleTask()">Submit & Earn</button>
                <div style="margin-top: 15px; display: flex; gap: 15px; justify-content: center; font-size: 11px;">
                    <span onclick="toggleView('proofs')" style="color:var(--success); cursor:pointer;">Payout History</span>
                    <span onclick="signOut()" style="color:#ff4757; cursor:pointer;">Logout</span>
                </div>
            </div>

            <div id="withdrawPanel" style="text-align: left; padding: 10px;">
                <h2 style="color:var(--primary); margin-bottom: 5px;">Request Payout</h2>
                <p style="font-size: 11px; color: #aaa; margin-bottom: 15px;">Daily limit: 1 request. Minimum: 500 CP.</p>
                <input type="text" id="payMethod" placeholder="Method (EzCash/Reload/Bank)" style="text-align: left; font-size: 14px;">
                <input type="text" id="payDetails" placeholder="Phone or Account Number" style="text-align: left; font-size: 14px;">
                <button class="btn-action" style="background:var(--success);" onclick="submitReq()">Confirm & Submit</button>
                <p onclick="hideWithdraw()" style="text-align:center; margin-top:15px; font-size:12px; color:#aaa; cursor:pointer;">Cancel</p>
            </div>
        </div>

        <div class="glass-card">
            <h3 style="text-align: left; color:#f1c40f; margin-top: 0;">üèÜ Elite Leaderboard (Top 5)</h3>
            <p style="text-align: left; font-size: 11px; color: #888; margin-bottom: 15px;">Only Top 5 workers are eligible for withdrawals.</p>
            <div id="leaderList">Loading...</div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCBW21NQG7100ZQ_phXtVPiY-IWRzNCGu0",
        authDomain: "earn-money-600d9.firebaseapp.com",
        databaseURL: "https://earn-money-600d9-default-rtdb.firebaseio.com",
        projectId: "earn-money-600d9",
        storageBucket: "earn-money-600d9.firebasestorage.app",
        messagingSenderId: "12987052490",
        appId: "1:12987052490:web:4b349f2ad5a1812d9adf33"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();
    emailjs.init("CpK7Sb10QnKQlsqJa");

    let currentUID, currentPoints, uName, uEmail, isTop5 = false;

    function signIn() { auth.signInWithPopup(provider); }
    function signOut() { auth.signOut(); location.reload(); }

    auth.onAuthStateChanged(async user => {
        if (user) {
            currentUID = user.uid; uName = user.displayName; uEmail = user.email;
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("mainDashboard").style.display = "block";
            document.getElementById("uNameDisp").innerText = uName;

            const s = await db.ref('users/' + currentUID).once('value');
            if (!s.exists()) {
                await db.ref('users/' + currentUID).set({ points: 0, lastWithdraw: 0, name: uName, email: uEmail });
                // Send Welcome Email
                emailjs.send('service_6awotbe', 'template_ky1u766', {
                    to_email: uEmail,
                    user_name: uName,
                    subject: "Welcome to EarnHub Elite!",
                    message: "‡∂î‡∂∂ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∑Ä‡∑í‡∂∫. ‡∂Ø‡∑ê‡∂±‡∑ä ‡∂î‡∂∂‡∂ß micro-tasks ‡∂ö‡∂ª ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∑É‡∑ô‡∑Ä‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö. ‡∑É‡∑î‡∂∑ ‡∂¥‡∑ê‡∂≠‡∑î‡∂∏‡∑ä!"
                });
            }
            startSync();
        }
    });

    function startSync() {
        // Points Sync
        db.ref('users/' + currentUID).on('value', s => {
            currentPoints = s.val().points || 0;
            document.getElementById("uPointsDisp").innerText = currentPoints + " CP";
            checkEligibility();
        });

        // Leaderboard Sync
        db.ref('users').orderByChild('points').limitToLast(10).on('value', s => {
            let html = ""; let arr = []; isTop5 = false;
            s.forEach(c => arr.push({uid: c.key, n: c.val().name, p: c.val().points}));
            arr.reverse().forEach((u, i) => {
                let rank = i + 1;
                if (u.uid === currentUID && rank <= 5) isTop5 = true;
                html += `<div class="list-item ${rank <= 5 ? 'top5' : ''}">
                    <span><b>${rank}.</b> ${u.n}</span>
                    <strong>${u.p} CP</strong>
                </div>`;
            });
            document.getElementById("leaderList").innerHTML = html;
            checkEligibility();
        });
    }

    function checkEligibility() {
        const btn = document.getElementById("mainWithdrawBtn");
        if (isTop5 && currentPoints >= 500) {
            btn.style.display = "block";
        } else {
            btn.style.display = "none";
        }
    }

    function genCaptcha() {
        captchaCode = Math.floor(1000 + Math.random() * 9000);
        document.getElementById("captchaBox").innerText = captchaCode;
    }

    async function handleTask() {
        if (document.getElementById("userInput").value == captchaCode) {
            document.getElementById("successSnd").play();
            window.open('https://www.effectivegatecpm.com/bfifb4kf8?key=4848fcef5dd96ae01528e28c2c90fd4f', '_blank');
            await db.ref('users/' + currentUID + '/points').transaction(p => (p || 0) + 10);
            document.getElementById("userInput").value = "";
            genCaptcha();
        } else { alert("Wrong Code!"); }
    }

    function showWithdraw() {
        document.getElementById("workSection").style.display = "none";
        document.getElementById("withdrawPanel").style.display = "block";
    }

    function hideWithdraw() {
        document.getElementById("withdrawPanel").style.display = "none";
        document.getElementById("workSection").style.display = "block";
    }

    async function submitReq() {
        const m = document.getElementById("payMethod").value;
        const d = document.getElementById("payDetails").value;
        if(!m || !d) return alert("Details required!");

        const s = await db.ref('users/' + currentUID).once('value');
        const lastW = s.val().lastWithdraw || 0;
        const now = Date.now();

        if (now - lastW < 24 * 60 * 60 * 1000) {
            return alert("‡∂Ø‡∑í‡∂±‡∂ö‡∂ß ‡∂ë‡∂ö‡∑ä ‡∑Ä‡∂ª‡∂ö‡∑ä ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä withdraw ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö. ‡∑Ñ‡∑ô‡∂ß ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
        }

        // Save Request
        await db.ref('requests').push({
            uid: currentUID, name: uName, email: uEmail, 
            points: currentPoints, method: m, details: d, date: new Date().toLocaleString()
        });

        // Update Last Withdraw Time
        await db.ref('users/' + currentUID + '/lastWithdraw').set(now);

        // Send Email to Admin (YOU)
        emailjs.send('service_6awotbe', 'template_ky1u766', {
            subject: "New Withdrawal Request!",
            message: `User: ${uName}\nEmail: ${uEmail}\nPoints: ${currentPoints}\nMethod: ${m}\nDetails: ${d}`
        });

        alert("Request Sent Successfully!");
        hideWithdraw();
    }

    genCaptcha();
</script>
</body>
</html>
